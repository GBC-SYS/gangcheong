<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      name="description"
      content="강남중앙침례교회 청년부 수련회 사랑의 언어 도장판"
    />

    <!-- Open Graph / 카카오톡 공유 -->
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://gbc-sys.github.io/gangcheong/mission/"
    />
    <meta property="og:title" content="LOVE in Action - 사랑의 언어 도장판" />
    <meta
      property="og:description"
      content="5가지 사랑의 언어로 사랑을 실천해요!"
    />
    <meta
      property="og:image"
      content="https://gbc-sys.github.io/gangcheong/mission/assets/images/seo.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="강남중앙침례교회 청년부" />
    <meta property="og:locale" content="ko_KR" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="LOVE in Action - 사랑의 언어 도장판" />
    <meta
      name="twitter:description"
      content="5가지 사랑의 언어로 사랑을 실천해요!"
    />
    <meta
      name="twitter:image"
      content="https://gbc-sys.github.io/gangcheong/mission/assets/images/seo.png"
    />

    <title>강청 | 사랑의 언어 도장판</title>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GLP4PQYH4P"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-GLP4PQYH4P");
    </script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- 스플래시 화면 -->
    <div id="splash" class="splash">
      <div class="splash__content">
        <div class="splash__logo">
          <img src="assets/images/logo.jpg" alt="로고" />
        </div>
        <div class="splash__text">
          <h1 class="splash__title">LOVE in Action</h1>
          <p class="splash__subtitle">사랑의 언어 도장판</p>
        </div>
        <div class="splash__loader">
          <div class="splash__loader-bar"></div>
        </div>
      </div>
      <p class="splash__footer">강남중앙침례교회 청년부</p>
    </div>

    <!-- 인트로 화면 -->
    <div id="intro" class="intro">
      <div class="intro__card">
        <div class="intro__icon">
          <img src="assets/images/logo.jpg" alt="로고" />
        </div>
        <h1 class="intro__title">2026 강청 겨울 수련회</h1>
        <p class="intro__subtitle">LOVE in Action - 사랑의 언어 도장판</p>

        <div class="intro__form">
          <label class="intro__label">당신의 이름은?</label>
          <input
            type="text"
            id="userName"
            class="intro__input"
            placeholder="홍길동"
          />
        </div>

        <button id="startBtn" class="intro__btn">
          시작하기
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <!-- 메인 앱 -->
    <div id="app" class="app" style="display: none">
      <!-- 헤더 (Header 컴포넌트로 렌더링) -->
      <header id="header" class="header"></header>

      <!-- 메인 콘텐츠 -->
      <main class="main">
        <!-- 시작 전 안내 -->
        <div id="beforeStartNotice" class="night-notice" style="display: none">
          <div class="night-notice__icon">🙏</div>
          <h2 class="night-notice__title">아직 미션 시작 전이에요!</h2>
          <p class="night-notice__desc">
            수련회 당일부터 미션이 시작됩니다.<br />
            조금만 기다려주세요!
          </p>
        </div>

        <!-- 미션 기간 종료 안내 -->
        <div id="missionEndedNotice" class="night-notice" style="display: none">
          <div class="night-notice__icon">🎉</div>
          <h2 class="night-notice__title">미션 기간이 끝났습니다</h2>
          <p class="night-notice__desc">
            사랑의 언어 미션에 참여해주셔서 감사합니다!<br />
            함께한 시간이 복된 추억이 되길 바랍니다.
          </p>
        </div>

        <!-- 도장판 섹션 -->
        <div id="stampSection" class="stamp-section">
          <p class="stamp-section__desc">
            5가지 사랑의 언어로 주변 사람들에게 사랑을 표현해보세요!<br />
            각 언어별로 대상자를 정하고, 미션을 선택한 뒤 완료하면 도장을
            받아요.
          </p>
          <a
            href="https://smore.im/quiz/PUE0jtfbsZ"
            target="_blank"
            class="stamp-section__quiz-link"
          >
            나의 사랑의 언어 테스트하기
          </a>
          <div id="stampContainer" class="stamp-container">
            <!-- 도장판 카드들이 동적으로 추가됩니다 -->
          </div>
        </div>
      </main>

      <!-- 하단 고정 공유 버튼 -->
      <div class="floating-share-wrapper">
        <button id="floatingShareBtn" class="floating-share-btn" disabled>
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
          <span>공유하기</span>
        </button>
        <div class="floating-share-tooltip">
          1개 이상 도장을 모으면 공유할 수 있어요!
        </div>
      </div>

      <!-- 하단 네비게이션 -->
      <div id="bottomNavContainer"></div>
    </div>

    <!-- 미션 선택 모달 -->
    <div id="missionModal" class="modal" style="display: none">
      <div class="modal__backdrop"></div>
      <div class="modal__content">
        <div class="modal__header">
          <h3 class="modal__title" id="modalTitle">미션 선택</h3>
          <button class="modal__close" id="modalClose">
            <?xml version="1.0" encoding="UTF-8"?><svg
              width="24px"
              height="24px"
              stroke-width="1.5"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              color="#ffffff"
            >
              <path
                d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426"
                stroke="#ffffff"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              ></path>
            </svg>
          </button>
        </div>
        <div class="modal__body">
          <div class="modal__target">
            <label class="modal__label">누구에게 사랑을 표현할까요?</label>
            <input
              type="text"
              id="targetName"
              class="modal__input"
              placeholder="대상자 이름"
            />
          </div>
          <div class="modal__missions">
            <label class="modal__label">어떤 미션을 수행할까요?</label>
            <div id="missionOptions" class="modal__options">
              <!-- 미션 옵션들이 동적으로 추가됩니다 -->
            </div>
          </div>
        </div>
        <div class="modal__footer">
          <button class="btn btn-secondary" id="modalCancel">취소</button>
          <button class="btn btn-primary" id="modalConfirm">확인</button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // 로컬스토리지 스키마 버전 관리
      (function () {
        const SCHEMA_VERSION = 1;
        const SCHEMA_KEY = "app_schema_version";

        // 버전별 마이그레이션 정의
        // - keysToRemove: 특정 키만 삭제
        // - clearAll: 전체 삭제
        const migrations = {
          1: {
            keysToRemove: [
              "stamp_data",
              "last_share_date",
              "userName",
              "splash_shown",
            ],
          },
          2: {
            keysToRemove: ["last_confetti_day1", "last_confetti_day2"],
          },
          // 예시: 전체 삭제가 필요한 경우
          99: { clearAll: true },
        };

        const savedVersion = parseInt(localStorage.getItem(SCHEMA_KEY)) || 0;

        if (savedVersion < SCHEMA_VERSION) {
          // 저장된 버전 이후의 모든 마이그레이션 실행
          for (let v = savedVersion + 1; v <= SCHEMA_VERSION; v++) {
            const migration = migrations[v];
            if (migration?.clearAll) {
              localStorage.clear();
            } else if (migration?.keysToRemove) {
              migration.keysToRemove.forEach((key) =>
                localStorage.removeItem(key),
              );
            }
          }

          localStorage.setItem(SCHEMA_KEY, SCHEMA_VERSION);
          console.log(
            `[Storage] 마이그레이션 완료: v${savedVersion} → v${SCHEMA_VERSION}`,
          );
        }
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="js/utils/url.js"></script>
    <script src="js/utils/date-checker.js"></script>
    <script src="js/components/Header.js"></script>
    <script src="js/components/bottom-nav.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
